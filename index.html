<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration Report</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
        h1, h2 { color: #333; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background-color: #4CAF50; color: white; }
        button { padding: 5px 10px; margin: 3px; cursor: pointer; }
        input, select { padding: 8px; margin: 5px; }
        .hidden { display: none; }
        .slideshow-container { max-width: 500px; position: relative; margin: auto; }
        .slide { display: none; width: 100%; }
    </style>
</head>
<body>

<h1>Registration Reports</h1>

<!-- Password Protection -->
<div id="passwordSection">
    <h2>Enter Password to Manage Data</h2>
    <input type="password" id="passwordInput" placeholder="Enter Password">
    <button onclick="checkPassword()">Submit</button>
</div>

<!-- Protected Section -->
<div id="protectedSection" class="hidden">
    <h2>Manage Names</h2>
    <form id="setupForm">
        <input type="text" id="nameInput" placeholder="Enter Name" required>
        <button type="submit">Add</button>
    </form>
    <ul id="namesList"></ul>

    <h2>Enter Daily Registrations</h2>
    <form id="registrationForm">
        <input type="hidden" id="editIndex">
        <input type="date" id="dateInput" required>
        <select id="personSelect"></select>
        <input type="number" id="countInput" placeholder="Registrations" required>
        <button type="submit">Submit</button>
    </form>

    <h2>Upload Daily Images</h2>
    <input type="file" id="imageInput" accept="image/*" multiple>
    <button onclick="uploadImage()">Upload</button>
    <button onclick="clearUploadedImages()">Clear Uploaded Images</button>
</div>

<!-- Slideshow -->
<h2>Daily Images</h2>
<div class="slideshow-container" id="imageSlideshow"></div>

<!-- Registration Table -->
<h2>All Registrations</h2>
<table>
    <thead id="tableHeader"></thead>
    <tbody id="tableBody"></tbody>
</table>

<h2>Daily Registration Graph</h2>
<div id="graphContainer"></div>

<script>
    const PASSWORD = "nationalidgetachew-2009";
    let loggedIn = false;

    function checkPassword() {
        if (document.getElementById("passwordInput").value === PASSWORD) {
            loggedIn = true;
            document.getElementById("passwordSection").classList.add("hidden");
            document.getElementById("protectedSection").classList.remove("hidden");
            generateReports();
            displaySlideshow();
            loadNames();
        } else {
            alert("Incorrect Password!");
        }
    }

    function loadData(key) {
        return JSON.parse(localStorage.getItem(key)) || [];
    }

    function saveData(key, data) {
        localStorage.setItem(key, JSON.stringify(data));
    }

    document.getElementById("setupForm").addEventListener("submit", function(event) {
        event.preventDefault();
        let name = document.getElementById("nameInput").value.trim();
        let namesList = loadData("namesData");

        if (!namesList.includes(name)) {
            namesList.push(name);
            saveData("namesData", namesList);
        }

        alert("Name Added!");
        generateReports();
    });

    function uploadImage() {
        let files = document.getElementById("imageInput").files;
        if (files.length === 0) {
            alert("Please select one or more images.");
            return;
        }

        let images = loadData("uploadedImages");
        Array.from(files).forEach(file => {
            let reader = new FileReader();
            reader.onload = function (e) {
                images.push(e.target.result);
                saveData("uploadedImages", images);
                displaySlideshow();
            };
            reader.readAsDataURL(file);
        });

        alert("Images Uploaded!");
    }

    function clearUploadedImages() {
        if (loggedIn) {
            localStorage.removeItem("uploadedImages");
            displaySlideshow();
        } else {
            alert("You must log in to clear images.");
        }
    }

    function displaySlideshow() {
        let images = loadData("uploadedImages");
        let container = document.getElementById("imageSlideshow");
        container.innerHTML = "";

        images.forEach((src, index) => {
            let img = document.createElement("img");
            img.src = src;
            img.className = "slide";
            if (index === 0) img.style.display = "block";
            container.appendChild(img);
        });

        let index = 0;
        setInterval(() => {
            let slides = document.querySelectorAll(".slide");
            slides.forEach(s => (s.style.display = "none"));
            slides[index].style.display = "block";
            index = (index + 1) % slides.length;
        }, 3000);
    }

    function generateReports() {
        let data = loadData("registrationData");
        let namesList = loadData("namesData");
        let groupedData = {};
        let dailyCounts = {};

        data.forEach(({ date, name, count }) => {
            if (!groupedData[date]) groupedData[date] = {};
            groupedData[date][name] = (groupedData[date][name] || 0) + count;
            dailyCounts[date] = (dailyCounts[date] || 0) + count;
        });

        let tableHeader = document.getElementById("tableHeader");
        let tableBody = document.getElementById("tableBody");
        tableHeader.innerHTML = `<tr><th>Date</th>${namesList.map(name => `<th>${name}</th>`).join("")}<th>Total</th>${loggedIn ? "<th>Actions</th>" : ""}</tr>`;
        tableBody.innerHTML = "";

        Object.keys(groupedData).forEach(date => {
            let row = `<td>${date}</td>`;
            let total = 0;
            namesList.forEach(name => {
                let count = groupedData[date][name] || 0;
                row += `<td>${count}</td>`;
                total += count;
            });
            row += `<td>${total}</td>`;
            if (loggedIn) {
                row += `<td><button onclick="deleteEntry('${date}')">Delete</button></td>`;
            }
            tableBody.innerHTML += `<tr>${row}</tr>`;
        });

        drawGraphs(dailyCounts);
    }

    function deleteEntry(date) {
        let data = loadData("registrationData");
        data = data.filter(entry => entry.date !== date);
        saveData("registrationData", data);
        generateReports();
    }

    function drawGraphs(dailyCounts) {
        let graphContainer = document.getElementById("graphContainer");
        graphContainer.innerHTML = `<canvas id="chartCanvas"></canvas>`;

        new Chart(document.getElementById("chartCanvas"), {
            type: "bar",
            data: { 
                labels: Object.keys(dailyCounts), 
                datasets: [{ label: "Registrations", data: Object.values(dailyCounts), backgroundColor: ["red", "blue", "green", "yellow", "purple"] }] 
            }
        });
    }

    generateReports();
    displaySlideshow();
</script>

</body>
</html>
