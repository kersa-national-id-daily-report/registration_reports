<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration Report</title>

    <!-- Chart.js for Graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Styling -->
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
        h1, h2 { color: #333; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background-color: #4CAF50; color: white; }
        button { padding: 5px 10px; margin: 3px; cursor: pointer; }
        canvas { max-width: 100%; }
        input, select { padding: 8px; margin: 5px; }
    </style>
</head>
<body>

    <h1>Registration Reports</h1>

    <!-- Password Protection -->
    <div id="passwordSection">
        <h2>Enter Password to Access Registration</h2>
        <input type="password" id="passwordInput" placeholder="Enter Password">
        <button onclick="checkPassword()">Submit</button>
    </div>

    <div id="mainContent" style="display: none;">
        <h2>Manage Names & Roles (One-Time Setup)</h2>
        <form id="setupForm">
            <input type="text" id="nameInput" placeholder="Enter Name" required>
            <input type="text" id="roleInput" placeholder="Enter Role" required>
            <button type="submit">Add</button>
        </form>

        <h2>Enter Daily Registrations</h2>
        <form id="registrationForm">
            <input type="date" id="dateInput" required>
            <select id="personSelect"></select>
            <input type="number" id="countInput" placeholder="Registrations" required>
            <button type="submit">Submit</button>
        </form>

        <h2>All Registrations</h2>
        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Name</th>
                    <th>Role</th>
                    <th>Registrations</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="allData"></tbody>
        </table>

        <h2>Weekly Registration Graph</h2>
        <canvas id="weeklyChart"></canvas>

        <h2>Monthly Registration Graph</h2>
        <canvas id="monthlyChart"></canvas>
    </div>

    <script>
        const PASSWORD = "nationalidgetachew-2009";

        function checkPassword() {
            let inputPassword = document.getElementById("passwordInput").value;
            if (inputPassword === PASSWORD) {
                document.getElementById("passwordSection").style.display = "none";
                document.getElementById("mainContent").style.display = "block";
                updateDropdown();
                generateReports();
            } else {
                alert("Incorrect Password!");
            }
        }

        function loadData(key) {
            return JSON.parse(localStorage.getItem(key)) || [];
        }

        function saveData(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }

        // Add Name & Role (One-Time)
        document.getElementById("setupForm").addEventListener("submit", function(event) {
            event.preventDefault();
            let name = document.getElementById("nameInput").value.trim();
            let role = document.getElementById("roleInput").value.trim();
            let namesList = loadData("namesData");

            namesList.push({ name, role });
            saveData("namesData", namesList);

            alert("Name & Role Added!");
            updateDropdown();
            event.target.reset();
        });

        // Update Dropdown for Registration Input
        function updateDropdown() {
            let select = document.getElementById("personSelect");
            select.innerHTML = "";
            let namesList = loadData("namesData");

            namesList.forEach(person => {
                let option = document.createElement("option");
                option.value = person.name;
                option.textContent = `${person.name} (${person.role})`;
                select.appendChild(option);
            });
        }

        // Add Daily Registrations
        document.getElementById("registrationForm").addEventListener("submit", function(event) {
            event.preventDefault();
            let date = document.getElementById("dateInput").value;
            let name = document.getElementById("personSelect").value;
            let count = parseInt(document.getElementById("countInput").value);

            let data = loadData("registrationData");
            data.push({ date, name, count });
            saveData("registrationData", data);

            alert("Data Saved!");
            generateReports();
        });

        // Edit & Delete Functions
        function editEntry(index) {
            let data = loadData("registrationData");
            let entry = data[index];

            document.getElementById("dateInput").value = entry.date;
            document.getElementById("personSelect").value = entry.name;
            document.getElementById("countInput").value = entry.count;

            data.splice(index, 1);
            saveData("registrationData", data);
            generateReports();
        }

        function deleteEntry(index) {
            let data = loadData("registrationData");
            data.splice(index, 1);
            saveData("registrationData", data);
            generateReports();
        }

        // Generate Reports & Graphs
        function generateReports() {
            let data = loadData("registrationData");
            let table = document.getElementById("allData");
            table.innerHTML = "";

            let weeklyCounts = {}, monthlyCounts = {};

            data.forEach((row, index) => {
                let { date, name, count } = row;
                let role = loadData("namesData").find(p => p.name === name)?.role || "Unknown";

                let tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${date}</td>
                    <td>${name}</td>
                    <td>${role}</td>
                    <td>${count}</td>
                    <td>
                        <button onclick="editEntry(${index})">Edit</button>
                        <button onclick="deleteEntry(${index})">Delete</button>
                    </td>
                `;
                table.appendChild(tr);

                let week = date.slice(0, 10);
                weeklyCounts[week] = (weeklyCounts[week] || 0) + count;

                let month = date.slice(0, 7);
                monthlyCounts[month] = (monthlyCounts[month] || 0) + count;
            });

            drawGraph("weeklyChart", Object.keys(weeklyCounts), Object.values(weeklyCounts), "Registrations Per Week");
            drawGraph("monthlyChart", Object.keys(monthlyCounts), Object.values(monthlyCounts), "Registrations Per Month");
        }

        // Draw Graphs
        function drawGraph(canvasId, labels, data, title) {
            new Chart(document.getElementById(canvasId), {
                type: "bar",
                data: { labels, datasets: [{ label: title, data, backgroundColor: "#4CAF50" }] },
                options: { responsive: true, scales: { y: { beginAtZero: true } } }
            });
        }

        updateDropdown();
    </script>

</body>
</html>
