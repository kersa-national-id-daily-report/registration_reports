<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration Report</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
        h1, h2 { color: #333; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background-color: #4CAF50; color: white; }
        button { padding: 5px 10px; margin: 3px; cursor: pointer; }
        input, select { padding: 8px; margin: 5px; }
        .hidden { display: none; }
    </style>
</head>
<body>

<h1>Registration Reports</h1>

<!-- Password Protection -->
<div id="passwordSection">
    <h2>Enter Password to Manage Data</h2>
    <input type="password" id="passwordInput" placeholder="Enter Password">
    <button onclick="checkPassword()">Submit</button>
</div>

<!-- Protected Section -->
<div id="protectedSection" class="hidden">
    <h2>Manage Names</h2>
    <form id="setupForm">
        <input type="text" id="nameInput" placeholder="Enter Name" required>
        <button type="submit">Add</button>
    </form>
    <ul id="namesList"></ul> <!-- Names List with Edit & Delete -->

    <h2>Enter Daily Registrations</h2>
    <form id="registrationForm">
        <input type="hidden" id="editIndex">
        <input type="date" id="dateInput" required>
        <select id="personSelect"></select>
        <input type="number" id="countInput" placeholder="Registrations" required>
        <button type="submit">Submit</button>
    </form>

    <h2>All Registrations</h2>
    <table>
        <thead id="tableHeader"></thead>
        <tbody id="tableBody"></tbody>
    </table>
</div>

<h2>Daily Registration Graph</h2>
<div id="graphContainer"></div>

<script>
    const PASSWORD = "nationalidgetachew-2009";
    let loggedIn = false;

    function checkPassword() {
        if (document.getElementById("passwordInput").value === PASSWORD) {
            loggedIn = true;
            document.getElementById("passwordSection").classList.add("hidden");
            document.getElementById("protectedSection").classList.remove("hidden");
            updateDropdown();
            generateReports();
            loadNames();
        } else {
            alert("Incorrect Password!");
        }
    }

    function loadData(key) {
        return JSON.parse(localStorage.getItem(key)) || [];
    }

    function saveData(key, data) {
        localStorage.setItem(key, JSON.stringify(data));
    }

    document.getElementById("setupForm").addEventListener("submit", function(event) {
        event.preventDefault();
        let name = document.getElementById("nameInput").value.trim();
        let namesList = loadData("namesData");

        if (!namesList.includes(name)) {
            namesList.push(name);
            saveData("namesData", namesList);
        }

        alert("Name Added!");
        updateDropdown();
        loadNames();
    });

    function loadNames() {
        let namesList = loadData("namesData");
        let list = document.getElementById("namesList");
        list.innerHTML = "";

        namesList.forEach((name, index) => {
            let li = document.createElement("li");
            li.innerHTML = `${name} 
                <button onclick="editName(${index})">Edit</button>
                <button onclick="deleteName(${index})">Delete</button>`;
            list.appendChild(li);
        });

        updateDropdown();
    }

    function editName(index) {
        let namesList = loadData("namesData");
        let newName = prompt("Edit Name:", namesList[index]);

        if (newName) {
            namesList[index] = newName;
            saveData("namesData", namesList);
            loadNames();
            updateDropdown();
        }
    }

    function deleteName(index) {
        let namesList = loadData("namesData");
        namesList.splice(index, 1);
        saveData("namesData", namesList);
        loadNames();
        updateDropdown();
    }

    function updateDropdown() {
        let select = document.getElementById("personSelect");
        select.innerHTML = `<option value="" disabled selected>Select a Name</option>`;
        let namesList = loadData("namesData");

        namesList.forEach(name => {
            let option = document.createElement("option");
            option.value = name;
            option.textContent = name;
            select.appendChild(option);
        });
    }

    document.getElementById("registrationForm").addEventListener("submit", function(event) {
        event.preventDefault();
        let date = document.getElementById("dateInput").value;
        let name = document.getElementById("personSelect").value;
        let count = document.getElementById("countInput").value;
        let index = document.getElementById("editIndex").value;

        let data = loadData("registrationData");

        if (index) {
            data[index] = { date, name, count };
        } else {
            data.push({ date, name, count });
        }

        saveData("registrationData", data);
        document.getElementById("editIndex").value = "";
        alert("Registration Saved!");
        generateReports();
    });

    function generateReports() {
        let data = loadData("registrationData");
        let namesList = loadData("namesData");
        let groupedData = {};
        let dailyCounts = {};

        data.forEach(({ date, name, count }, index) => {
            if (!groupedData[date]) groupedData[date] = {};
            groupedData[date][name] = count;
            dailyCounts[date] = (dailyCounts[date] || 0) + count;
        });

        let tableHeader = document.getElementById("tableHeader");
        let tableBody = document.getElementById("tableBody");
        tableHeader.innerHTML = `<tr><th>Date</th>${namesList.map(name => `<th>${name}</th>`).join("")}<th>Total</th><th>Actions</th></tr>`;
        tableBody.innerHTML = "";

        data.forEach(({ date, name, count }, index) => {
            let row = `<td>${date}</td>`;
            let total = 0;

            namesList.forEach(n => {
                let value = n === name ? count : 0;
                row += `<td>${value}</td>`;
                total += parseInt(value);
            });

            row += `<td>${total}</td>`;
            row += `<td>
                        <button onclick="editRegistration(${index})">Edit</button>
                        <button onclick="deleteRegistration(${index})">Delete</button>
                    </td>`;

            tableBody.innerHTML += `<tr>${row}</tr>`;
        });

        drawGraphs(dailyCounts);
    }

    function editRegistration(index) {
        let data = loadData("registrationData");
        let entry = data[index];

        document.getElementById("dateInput").value = entry.date;
        document.getElementById("personSelect").value = entry.name;
        document.getElementById("countInput").value = entry.count;
        document.getElementById("editIndex").value = index;
    }

    function deleteRegistration(index) {
        let data = loadData("registrationData");
        data.splice(index, 1);
        saveData("registrationData", data);
        generateReports();
    }

    function drawGraphs(dailyCounts) {
        let graphContainer = document.getElementById("graphContainer");
        graphContainer.innerHTML = `<canvas id="chartCanvas"></canvas>`;

        new Chart(document.getElementById("chartCanvas"), {
            type: "bar",
            data: { labels: Object.keys(dailyCounts), datasets: [{ label: "Registrations", data: Object.values(dailyCounts), backgroundColor: "blue" }] }
        });
    }

    loadNames();
    generateReports();
</script>

</body>
</html>
