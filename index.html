<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration Report</title>

    <!-- Chart.js for Graphs -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Styling -->
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
        h1, h2 { color: #333; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background-color: #4CAF50; color: white; }
        button { padding: 5px 10px; margin: 3px; cursor: pointer; }
        canvas { max-width: 100%; display: block; margin: auto; }
        input, select { padding: 8px; margin: 5px; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <h1>Registration Reports</h1>

    <!-- Password Protection -->
    <div id="passwordSection">
        <h2>Enter Password to Manage Data</h2>
        <input type="password" id="passwordInput" placeholder="Enter Password">
        <button onclick="checkPassword()">Submit</button>
    </div>

    <div id="protectedSection" class="hidden">
        <h2>Manage Names & Roles</h2>
        <form id="setupForm">
            <input type="text" id="nameInput" placeholder="Enter Name" required>
            <input type="text" id="roleInput" placeholder="Enter Role" required>
            <button type="submit">Add</button>
        </form>

        <h2>Enter Daily Registrations</h2>
        <form id="registrationForm">
            <input type="hidden" id="editIndex">
            <input type="date" id="dateInput" required>
            <select id="personSelect"></select>
            <input type="number" id="countInput" placeholder="Registrations" required>
            <button type="submit">Submit</button>
        </form>
    </div>

    <h2>All Registrations</h2>
    <table>
        <thead id="tableHeader"></thead>
        <tbody id="tableBody"></tbody>
    </table>

    <h2>Daily Registration Graph</h2>
    <div id="graphContainer"></div>

    <script>
        const PASSWORD = "nationalidgetachew-2009";
        let loggedIn = false;

        function checkPassword() {
            if (document.getElementById("passwordInput").value === PASSWORD) {
                loggedIn = true;
                document.getElementById("passwordSection").classList.add("hidden");
                document.getElementById("protectedSection").classList.remove("hidden");
                generateReports();
            } else {
                alert("Incorrect Password!");
            }
        }

        function loadData(key) {
            return JSON.parse(localStorage.getItem(key)) || [];
        }

        function saveData(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }

        document.getElementById("setupForm").addEventListener("submit", function(event) {
            event.preventDefault();
            let name = document.getElementById("nameInput").value.trim();
            let role = document.getElementById("roleInput").value.trim();
            let namesList = loadData("namesData");

            namesList.push({ name, role });
            saveData("namesData", namesList);

            alert("Name & Role Added!");
            generateReports();
        });

        document.getElementById("registrationForm").addEventListener("submit", function(event) {
            event.preventDefault();
            let date = document.getElementById("dateInput").value;
            let name = document.getElementById("personSelect").value;
            let count = parseInt(document.getElementById("countInput").value);
            let editIndex = document.getElementById("editIndex").value;
            let data = loadData("registrationData");

            if (editIndex) {
                data[editIndex] = { date, name, count };
            } else {
                data.push({ date, name, count });
            }

            saveData("registrationData", data);
            alert("Data Saved!");
            document.getElementById("editIndex").value = "";
            event.target.reset();
            generateReports();
        });

        function generateReports() {
            let data = loadData("registrationData");
            let namesList = loadData("namesData").map(p => p.name);
            let groupedData = {};
            let dailyCounts = {}, weeklyCounts = {}, monthlyCounts = {};

            data.forEach(({ date, name, count }) => {
                if (!groupedData[date]) groupedData[date] = {};
                groupedData[date][name] = (groupedData[date][name] || 0) + count;
                dailyCounts[date] = (dailyCounts[date] || 0) + count;

                let week = date.slice(0, 10);
                let month = date.slice(0, 7);
                weeklyCounts[week] = (weeklyCounts[week] || 0) + count;
                monthlyCounts[month] = (monthlyCounts[month] || 0) + count;
            });

            let tableHeader = document.getElementById("tableHeader");
            let tableBody = document.getElementById("tableBody");
            tableHeader.innerHTML = "<tr><th>Date</th><th>Name</th><th>Registrations</th><th>Daily Total</th><th>Weekly Total</th><th>Monthly Total</th>" + 
                                    (loggedIn ? "<th>Actions</th>" : "") + "</tr>";
            tableBody.innerHTML = "";

            Object.keys(groupedData).forEach(date => {
                namesList.forEach(name => {
                    let count = groupedData[date][name] || 0;
                    let dailyTotal = dailyCounts[date] || 0;
                    let week = date.slice(0, 10);
                    let month = date.slice(0, 7);
                    let weeklyTotal = weeklyCounts[week] || 0;
                    let monthlyTotal = monthlyCounts[month] || 0;

                    let row = `<td>${date}</td><td>${name}</td><td>${count}</td>
                               <td>${dailyTotal}</td><td>${weeklyTotal}</td><td>${monthlyTotal}</td>`;

                    if (loggedIn) {
                        row += `<td><button onclick="editEntry(${index})">Edit</button> 
                                    <button onclick="deleteEntry(${index})">Delete</button></td>`;
                    }

                    tableBody.innerHTML += `<tr>${row}</tr>`;
                });
            });

            drawGraphs(dailyCounts);
        }

        function drawGraphs(dailyCounts) {
            let graphContainer = document.getElementById("graphContainer");
            graphContainer.innerHTML = "";

            let dates = Object.keys(dailyCounts);
            for (let i = 0; i < dates.length; i += 5) {
                let canvas = document.createElement("canvas");
                canvas.id = `chart${i}`;
                graphContainer.appendChild(canvas);
                drawGraph(canvas.id, dates.slice(i, i + 5), dates.slice(i, i + 5).map(d => dailyCounts[d]));
            }
        }

        function drawGraph(canvasId, labels, data) {
            new Chart(document.getElementById(canvasId), { type: "bar", data: { labels, datasets: [{ data }]

drawGraph(canvas.id, dates.slice(i, i + 5), dates.slice(i, i + 5).map(d => dailyCounts[d]), "Daily Registrations");
            }
        }

        function drawGraph(canvasId, labels, data, title) {
            new Chart(document.getElementById(canvasId), {
                type: "bar",
                data: {
                    labels: labels,
                    datasets: [{
                        label: title,
                        data: data,
                        backgroundColor: ["#FF5733", "#33FF57", "#3357FF", "#FF33A1", "#33FFF9"],
                        borderColor: "#000",
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: { y: { beginAtZero: true } },
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: true }
                    }
                }
            });
        }

        function editEntry(index) {
            if (!loggedIn) return;
            let data = loadData("registrationData")[index];
            document.getElementById("dateInput").value = data.date;
            document.getElementById("personSelect").value = data.name;
            document.getElementById("countInput").value = data.count;
            document.getElementById("editIndex").value = index;
        }

        function deleteEntry(index) {
            if (!loggedIn) return;
            let data = loadData("registrationData");
            data.splice(index, 1);
            saveData("registrationData", data);
            generateReports();
        }

        generateReports();
    </script>

</body>
</html>


        
